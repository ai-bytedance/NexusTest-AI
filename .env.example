# ----------------------------------------------------------------------------
# Core app settings
# ----------------------------------------------------------------------------
APP_ENV=local
SECRET_KEY=replace_me
SECRET_ENC_KEY=v1:MDEyMzQ1Njc4OWFiY2RlZjAxMjM0NTY3ODlhYmNkZWY=
APP_VERSION=0.1.0
GIT_COMMIT_SHA=development
BUILD_TIME=2024-01-01T00:00:00Z

# ----------------------------------------------------------------------------
# Database & cache
# ----------------------------------------------------------------------------
DATABASE_URL=postgresql+psycopg://app:app@postgres:5432/app
REDIS_URL=redis://redis:6379/0

# ----------------------------------------------------------------------------
# Auth & tokens
# ----------------------------------------------------------------------------
ACCESS_TOKEN_EXPIRE_MINUTES=60
TOKEN_CLOCK_SKEW_SECONDS=30
TOKEN_ROTATION_GRACE_SECONDS=300
SSO_STATE_TTL_SECONDS=600

# OAuth / OIDC (optional)
GITHUB_CLIENT_ID=
GITHUB_CLIENT_SECRET=
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
FEISHU_CLIENT_ID=
FEISHU_CLIENT_SECRET=
OIDC_ISSUER=
OIDC_CLIENT_ID=
OIDC_CLIENT_SECRET=
OIDC_SCOPES=openid,profile,email

# ----------------------------------------------------------------------------
# HTTP server & client
# ----------------------------------------------------------------------------
UVICORN_WORKERS=2
REQUEST_TIMEOUT_SECONDS=30
MAX_RESPONSE_SIZE_BYTES=512000

# CORS configuration
# BACKEND_CORS_ORIGINS accepts several formats:
# - Empty string (default) disables cross-origin requests unless ALLOW_ANY_ORIGIN is true:
#     BACKEND_CORS_ORIGINS=""
# - Single origin URL:
#     BACKEND_CORS_ORIGINS=http://localhost:3000
# - Comma-separated list:
#     BACKEND_CORS_ORIGINS=http://localhost:3000,http://127.0.0.1:3000
# - JSON array (recommended for production):
#     BACKEND_CORS_ORIGINS=["http://localhost:3000","http://127.0.0.1:3000"]
# - Wildcard grants public access and automatically disables credentials:
#     BACKEND_CORS_ORIGINS=*
#
# When ALLOW_ANY_ORIGIN=true the API serves all origins (credentials disabled).
BACKEND_CORS_ORIGINS=""
ALLOW_ANY_ORIGIN=false

# httpx client tuning
HTTPX_CONNECT_TIMEOUT=5.0
HTTPX_READ_TIMEOUT=30.0
HTTPX_WRITE_TIMEOUT=30.0
HTTPX_POOL_TIMEOUT=5.0
HTTPX_KEEPALIVE_EXPIRY=30.0
HTTPX_MAX_CONNECTIONS=100
HTTPX_MAX_KEEPALIVE_CONNECTIONS=20
HTTPX_RETRY_ATTEMPTS=3
HTTPX_RETRY_BACKOFF_FACTOR=0.5
HTTPX_RETRY_STATUSES=429,500,502,503,504
HTTPX_RETRY_METHODS=GET,HEAD,OPTIONS,PUT,DELETE,POST,PATCH

# ----------------------------------------------------------------------------
# AI provider selection & limits
# ----------------------------------------------------------------------------
PROVIDER=mock
AI_CHAT_RATE_LIMIT_PER_MINUTE=30
AI_CHAT_MESSAGE_MAX_BYTES=16000

# DeepSeek (default)
DEEPSEEK_API_KEY=
DEEPSEEK_BASE_URL=https://api.deepseek.com
DEEPSEEK_MODEL=deepseek-chat

# OpenAI
OPENAI_API_KEY=
OPENAI_BASE_URL=
OPENAI_MODEL=gpt-4o-mini

# Anthropic Claude
ANTHROPIC_API_KEY=
ANTHROPIC_BASE_URL=
ANTHROPIC_MODEL=claude-3-5-sonnet-20240620

# Google Gemini
GOOGLE_API_KEY=
GOOGLE_BASE_URL=
GEMINI_MODEL=gemini-1.5-flash

# Alibaba Qwen
QWEN_API_KEY=
QWEN_BASE_URL=
QWEN_MODEL=qwen-plus

# Zhipu GLM
ZHIPU_API_KEY=
ZHIPU_BASE_URL=
GLM_MODEL=glm-4-airx

# ByteDance Doubao
DOUBAO_API_KEY=
DOUBAO_BASE_URL=
DOUBAO_MODEL=doubao-pro-4k

# ----------------------------------------------------------------------------
# Reporting & exports
# ----------------------------------------------------------------------------
REPORT_EXPORT_MAX_BYTES=5242880
PDF_ENGINE=weasyprint
REPORT_EXPORT_FONT_PATH=
REPORT_EXPORT_BRANDING_TITLE=Test Execution Report
REPORT_EXPORT_BRANDING_LOGO=
REPORT_EXPORT_BRANDING_FOOTER=
REPORT_EXPORT_BRANDING_COMPANY=

# Payload redaction
REDACT_FIELDS=authorization,password,token,secret
REDACTION_PLACEHOLDER=***

# ----------------------------------------------------------------------------
# Datasets & plans
# ----------------------------------------------------------------------------
DATASET_STORAGE_DIR=./storage/datasets
PLAN_REFRESH_SECONDS=30
ANALYTICS_WINDOW=50
CLUSTER_MIN_COUNT=2

# ----------------------------------------------------------------------------
# Notifications
# ----------------------------------------------------------------------------
NOTIFY_MAX_RETRIES=3
NOTIFY_BACKOFF_SECONDS=5

# Email (choose one provider)
SMTP_HOST=
SMTP_PORT=587
SMTP_USER=
SMTP_PASSWORD=
SMTP_FROM=
SMTP_FROM_NAME=
SMTP_TLS=true
SENDGRID_API_KEY=
MAILGUN_API_KEY=

FEISHU_SIGNING_SECRET=
SLACK_DEFAULT_CHANNEL=

# ----------------------------------------------------------------------------
# Metrics & observability
# ----------------------------------------------------------------------------
METRICS_ENABLED=false
METRICS_NAMESPACE=nexustest
METRICS_HOST=0.0.0.0
METRICS_PORT=9464
CELERY_METRICS_PORT=9540
CELERY_METRICS_POLL_INTERVAL_SECONDS=15
OTEL_TRACE_PROPAGATION_ENABLED=false
HEALTH_CHECK_TIMEOUT_SECONDS=2.0

# ----------------------------------------------------------------------------
# Celery tuning
# ----------------------------------------------------------------------------
CELERY_WORKER_CONCURRENCY=4
CELERY_WORKER_PREFETCH_MULTIPLIER=1
CELERY_VISIBILITY_TIMEOUT_SECONDS=3600
CELERY_TASK_ACKS_LATE=true
CELERY_TASK_REJECT_ON_WORKER_LOST=true

# ----------------------------------------------------------------------------
# Agents (heartbeat & alerts)
# ----------------------------------------------------------------------------
AGENT_HEALTH_CHECK_SECONDS=60
AGENT_HEARTBEAT_RATE_LIMIT_PER_MINUTE=60
AGENT_OFFLINE_THRESHOLD_SECONDS=120
AGENT_BACKLOG_THRESHOLD=25
AGENT_LATENCY_THRESHOLD_MS=1000

# ----------------------------------------------------------------------------
# Backups & retention
# ----------------------------------------------------------------------------
BACKUP_BASE_DIR=./storage/backups
BACKUP_KEEP_DAILY=7
BACKUP_KEEP_WEEKLY=4
BACKUP_KEEP_MONTHLY=12
BACKUP_S3_BUCKET=
BACKUP_S3_PREFIX=
BACKUP_S3_REGION=
BACKUP_S3_ENDPOINT_URL=
BACKUP_S3_ACCESS_KEY=
BACKUP_S3_SECRET_KEY=
BACKUP_S3_USE_SSL=true
BACKUP_ENCRYPT=false
BACKUP_GPG_RECIPIENT=
BACKUP_GPG_PUBLIC_KEY_PATH=
BACKUP_VERIFY_EVERY_N_DAYS=7
BACKUP_VERIFY_TARGET_URL=
BACKUP_JOB_CRON=0 2 * * *
RETENTION_JOB_CRON=0 3 * * *
REPORT_RETENTION_DAYS=30
AI_TASK_RETENTION_DAYS=30
AUDIT_LOG_RETENTION_DAYS=90

# Report archive (optional)
REPORT_ARCHIVE_DIR=
REPORT_ARCHIVE_S3_BUCKET=
REPORT_ARCHIVE_S3_PREFIX=
REPORT_ARCHIVE_MIN_BYTES=262144

# ----------------------------------------------------------------------------
# Docker build defaults for Compose
# ----------------------------------------------------------------------------
# Set to nginx:1.25-alpine to use the official Docker Hub tag once connectivity allows.
NGINX_BASE_IMAGE=registry.cn-hangzhou.aliyuncs.com/dockerhub/nginx:1.25-alpine

# ----------------------------------------------------------------------------
# Local Postgres defaults for Compose
# ----------------------------------------------------------------------------
POSTGRES_USER=app
POSTGRES_PASSWORD=app
POSTGRES_DB=app
